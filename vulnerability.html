<!DOCTYPE html>
<html>

<head>
<meta charset='utf-8' />
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<meta name="description" content="Retire.js : What you require you must also retire" />

<link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

<title>Retire.js</title>
</head>

<body>

<!-- HEADER -->
<div id="header_wrap" class="outer">
	<header class="inner">
		<a id="forkme_banner" href="https://github.com/bekk/retire.js">View on GitHub</a>
		<h1 id="project_title">Retire.js</h1>
	</header>
</div>
<div id="main_content_wrap" class="outer">
<section id="main_content" class="inner">

<div id="vulnerable" style="display: none">
	<h3><span class="name"></span> <span class="version"></span></h3>
	<p><label class="status">This version has known vulnerabilities.</label></p>
	<table id="vulnsnode">
		<tr><th>From version</th><th>Up to version</th><th>Links</th></tr>
	</table>
	<p>You are using a vulnerable version of a library. This doesn't necessarily mean your site is vulnerable, but it might. We recommend you upgrade to a newer version.</p>
	<p>To read more about the risk, please visit:<br>
	<a href="https://www.owasp.org/index.php/Top_10_2013-A9-Using_Components_with_Known_Vulnerabilities">OWASP Top 10 2013-A9 Using Components with Known Vulnerabilities</p>

</div>
<div id="notVulnerable" style="display: none">
	<h3><span class="name"></span> <span class="version"></span></h3>
	<p><label class="status">This version does not have any known vulnerabilities.</label></p>
</div>
<div id="notFound" style="display: none">
	<h3><span class="name"></span> <span class="version"></span></h3>
	<p>This library was not found in the repository.</p>
</div>


</section>
</div>

<!-- FOOTER  -->
<div id="footer_wrap" class="outer">
<footer class="inner">
<p class="copyright">Retire.js maintained by <a href="https://github.com/bekk">bekk</a></p>
<p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
</footer>
</div>

<script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
<script>
if (document.location.hash && document.location.hash.substring(1)) {
	$.getJSON("//rawgit.com/bekk/retire.js/master/repository/jsrepository.json", init);
}
function init(jsrepo) {
	$.getJSON("//rawgit.com/bekk/retire.js/master/repository/npmrepository.json", function(noderepo) {
		initDone(jsrepo, noderepo);
	});
}
function initDone(jsRepo, nodeRepo) {
	var loc = document.location.hash.substring(1);
	var parameters = loc.split("&").map(function(p) { return p.split("=")});
	var name = null;
	var version = null;
	for (var i in parameters) {
		if (parameters[i][0] == "name") name = parameters[i][1].toLowerCase();
		if (parameters[i][0] == "version") version = parameters[i][1];
	}
	if (!(name) && !(version)) {
		return;
	}
	$(".name").text(name);
	$(".version").text(version);

	var component = jsRepo[name] || nodeRepo[name];
	if (component) {

		var vulns = [];
		for (var i in component.vulnerabilities) {
			var v = component.vulnerabilities[i];
			var above = !v.atOrAbove || isAtOrAbove(version, v.atOrAbove);
			var below = !v.below || !isAtOrAbove(version, v.below);
			if (above && below) {
				vulns.push(v);
			}
		}
		if (vulns.length > 0) {
			$("#vulnerable").show();
			for(var i in vulns) {
				var tr = $("<tr>").appendTo("table");
				$("<td>").appendTo(tr).text(vulns[i].atOrAbove || "-");
				$("<td>").appendTo(tr).text(vulns[i].below || "-");
				var td = $("<td>").appendTo(tr);
		        var breaker = "";
		        for (var k in vulns[i].info) {
		          var url = vulns[i].info[k];
		          td.append(breaker).append($("<a>").attr("href", url).text(url));
		          breaker = "<br>";
		        }
			}
		} else {
			$("#notVulnerable").show();			
		}
	} else {
		$("#notFound").show();			
	}
}

function isAtOrAbove(version1, version2) {
	console.log(version1, version2);
	var v1 = version1.split(/[\.\-]/g);
	var v2 = version2.split(/[\.\-]/g);
	var l = v1.length > v2.length ? v1.length : v2.length;
	for (var i = 0; i < l; i++) {
		var v1_c = toComparable(v1[i]);
		var v2_c = toComparable(v2[i]);
		if (typeof v1_c !== typeof v2_c) return typeof v1_c === 'number';
		if (v1_c > v2_c) return true;
		if (v1_c < v2_c) return false;
	}
	return true;
}

function toComparable(n) {
	if (!isDefined(n)) return 0;
	if (n.match(/^[0-9]+$/)) {
		return parseInt(n, 10);
	}
	return n;
}

function isDefined(o) {
	return typeof o !== 'undefined';
}

</script>



</body>
</html>